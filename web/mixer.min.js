"use strict";(()=>{const e=document.getElementById("channels"),t=document.getElementById("aux"),n=document.getElementById("panning"),a=document.getElementById("auxiliaries"),l=document.getElementById("snapshot");let s=null,o=null,i=null,d=null;function c(e){let n=parseFloat(this.value);if(this.parentNode.style.setProperty("--value",100*n+"%"),!s)return;let a="level";this.classList.contains("volumeInput")&&(n=function(e){const t=Math.log(100*e)/Math.log(100)*100-90;return t===-1/0?-150:t}(n)),this.classList.contains("panInput")&&(a="pan"),u("/Input_Channels/"+this.dataset.channel+"/Aux_Send/"+t.options[t.selectedIndex].dataset.channel+"/send_"+a,[n])}function u(e,t=[]){s.readyState==WebSocket.OPEN&&s.send(JSON.stringify({address:e,args:t}))}function r(n){let s=JSON.parse(n.data);if(s.config)return l.innerText=s.config.snapshot,function(e){if(!e)return;let n="";a.innerHTML="";for(let t of e){if(!t.enabled){localStorage.getItem("aux")==t.channel&&localStorage.removeItem("aux");continue}let e=t.icon?t.icon:"",l=p(t.colour);n+='<option value="'+t.channel+'" data-channel="'+t.channel+'" data-colour="'+l+'" data-stereo="'+t.stereo+'" data-icon="'+e+'">'+t.label+"</option>";let s=document.createElement("button");s.value=t.channel,s.style.setProperty("--tint",l);let o=document.createElement("img");o.src=e,o.width=30,o.height=30,s.appendChild(o);let i=document.createTextNode(t.label);s.appendChild(i),a.appendChild(s)}t.innerHTML=n,localStorage.getItem("aux")?t.value=localStorage.getItem("aux"):document.body.classList.add("auxPicker")}(s.config.aux),function(t){let n="";for(let e of t)""!=e.title&&(n+='<h2 style="order:'+e.order+'">'+e.title+"</h2>"),n+="<div"+(e.enabled?"":' class="disabled"')+' style="order:'+e.order+'">',n+='<label class="volume">',""!=e.icon&&(n+='<img src="'+e.icon+'" width="22" height="22" class="icon" />'),n+="<span>"+e.label+'</span><input type="range" data-channel="'+e.channel+'" class="volumeInput" step="0.001" min="0" max="1" value="0" /></label>',n+='<label class="pan">',""!=e.icon&&(n+='<img src="'+e.icon+'" width="22" height="22" class="icon" />'),n+="<span>"+e.label+'</span><input type="range" data-channel="'+e.channel+'" class="panInput" step="0.001" min="0" max="1" value="0.5" /></label>',n+="</div>";e.innerHTML=n;for(let e of document.querySelectorAll(".volumeInput, .panInput"))e.addEventListener("input",c),e.addEventListener("touchstart",h),e.addEventListener("dblclick",v);i=[...document.getElementsByClassName("volumeInput")],d=[...document.getElementsByClassName("panInput")]}(s.config.channels),void t.dispatchEvent(new Event("change"));"/SnapshotName"==s.address&&(l.innerText=s.args[0]);let o=s.address.match(/^\/Input_Channels\/([0-9]+)\/Aux_Send\/([0-9]+)\/send_level$/);if(null!==o&&o[2]==t.options[t.selectedIndex].dataset.channel){let e=i[o[1]-1];e.value=(u=parseFloat(s.args[0]),Math.pow(100,(u+90)/100)/100),e.parentNode.style.setProperty("--value",100*e.value+"%")}var u;let r=s.address.match(/^\/Input_Channels\/([0-9]+)\/Aux_Send\/([0-9]+)\/send_pan$/);if(null!==r&&r[2]==t.options[t.selectedIndex].dataset.channel){let e=d[r[1]-1];e.value=s.args[0],e.parentNode.style.setProperty("--value",100*e.value+"%")}let m=s.address.match(/^\/Input_Channels\/([0-9]+)\/Channel_Input\/name$/);if(null!==m)for(let e of document.querySelectorAll('input[data-channel="'+m[1]+'"]'))e.previousElementSibling.innerHTML=s.args[0];let g=s.address.match(/^\/Aux_Outputs\/([0-9]+)\/Buss_Trim\/name$/);if(null!==g){for(let e of t.options)e.value==g[1]&&(e.innerHTML=s.args[0],t.previousElementSibling.innerHTML=t.getElementsByTagName("option")[t.selectedIndex].text);for(let e of a.getElementsByTagName("button"))if(e.value==g[1])return void(e.lastChild.nodeValue=s.args[0])}}function p(e){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?[parseInt(t[1],16),parseInt(t[2],16),parseInt(t[3],16)].join(","):null}t.addEventListener("mousedown",(function(e){e.preventDefault(),e.stopImmediatePropagation(),document.body.classList.add("auxPicker")})),a.addEventListener("click",(function(e){"BUTTON"==e.target.nodeName&&(t.value=e.target.value,t.dispatchEvent(new Event("change")),document.body.classList.remove("auxPicker"))}));let m=!1;function h(e){if(!m)return m=!0,setTimeout((function(){m=!1}),300),!1;v(e)}function v(e){e.target.classList.contains("volumeInput")&&(e.target.value=0),e.target.classList.contains("panInput")&&(e.target.value=.5),e.target.dispatchEvent(new Event("input"))}function g(){document.body.classList.remove("disconnected")}function f(){s&&s.close(),clearTimeout(o),o=setTimeout(y,2e3),document.body.classList.add("disconnected")}function y(){s=new WebSocket("ws://"+document.location.host),s.onopen=g,s.onmessage=r,s.onclose=f,s.onerror=f,clearTimeout(o),o=setTimeout((()=>{s.readyState===WebSocket.CONNECTING&&y()}),2e3)}document.addEventListener("DOMContentLoaded",(function(){n.checked=!1,y(),t.addEventListener("change",(function(e){localStorage.setItem("aux",this.value);let a=this.getElementsByTagName("option")[this.selectedIndex],l=a.dataset.colour;document.body.style.setProperty("--tint",l),this.previousElementSibling.innerHTML=a.text,this.previousElementSibling.previousElementSibling.src=a.dataset.icon,"true"==a.dataset.stereo?n.parentNode.style.display="flex":n.parentNode.style.display="none",n.checked=!1,n.dispatchEvent(new Event("change"));for(let e of i)e.value=0,e.parentNode.style.setProperty("--value",100*e.value+"%");for(let e of d)e.value=.5,e.parentNode.style.setProperty("--value",100*e.value+"%");!function(){for(let e=1;e<=[...document.getElementsByClassName("volumeInput")].length;e++)u("/Input_Channels/"+e+"/Aux_Send/"+t.options[t.selectedIndex].value+"/send_level/?"),u("/Input_Channels/"+e+"/Aux_Send/"+t.options[t.selectedIndex].value+"/send_pan/?")}()})),n.addEventListener("change",(function(e){this.checked?document.body.classList.add("panning"):document.body.classList.remove("panning")}))}))})();
